#Learning  #DevOps #Docker
# docker镜像的实际使用学习

1. 下载安装docker工具
2. 获取该软件的docker镜像
3. 运行该镜像，然后启动一个容器，这个服务就运行在容器中
4. 停止容器，删除该镜像

## 获取镜像

```perl
# 1. 获取镜像，镜像托管仓库，好比yum源一样
# 
docker info | grep Root
cd /var/lib/docker/image/overlay2/imagedb/content/sha256/
docker ps -a

 # 查看镜像存储的位置
[root@Serverb sha256]# docker info | grep Root
 Docker Root Dir: /var/lib/docker
 
[root@Serverb ~]# cd /var/lib/docker/image/overlay2/imagedb/content/sha256/

 # 该文件的作用是 记录镜像和容器的配置关系 
[root@Serverb sha256]# ll
总用量 24
-rw------- 1 root root 4361 5月  18 14:18 4a19aeaf68e573e0f68c8f6e00f9dc9d046103204645e51300f78057ce858571
-rw------- 1 root root 2142 5月  17 11:39 5d0da3dc976460b72c77d94c8a1ad043720b0416bfc16c52c45d4847e53fadb6
-rw------- 1 root root 7656 5月  17 10:33 605c77e624ddb75e6110f997c58876baa13f8754486b461117934b24a9dc3a85
-rw------- 1 root root 3177 5月  17 12:00 e69d4e2b6757d8bab7da7e3d268c170576dd5245b745e9c61530143d887d474c
[root@Serverb sha256]# docker ps -a
CONTAINER ID   IMAGE     COMMAND                   CREATED          STATUS                      PORTS                                   NAMES
e6582a1b4e32   centos    "/bin/bash"               24 minutes ago   Exited (0) 19 minutes ago                                           sleepy_tharp
7feff9e22b49   centos    "bash"                    25 minutes ago   Up 25 minutes                                                       friendly_liskov
d84f1adc3a64   nginx     "/docker-entrypoint.…"   29 minutes ago   Up 29 minutes               0.0.0.0:8080->80/tcp, :::8080->80/tcp   strange_snyder


```

## 查看镜像
```perl
# 搜索docker hub镜像
docker search 镜像名
docker images
docker images nginx
docker images -q
docker images --format "{{.ID}}--{{.Repository}}"

# 查看本地镜像
[node2@Serverb ~]$ docker images
REPOSITORY        TAG       IMAGE ID       CREATED       SIZE
dockurr/windows   latest    4a19aeaf68e5   2 days ago    425MB
nginx             latest    605c77e624dd   2 years ago   141MB
centos            latest    5d0da3dc9764   2 years ago   231MB
boystar/ubantu    latest    e69d4e2b6757   6 years ago   237MB

# 查看具体的镜像
[node2@Serverb ~]$ docker images nginx
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
nginx        latest    605c77e624dd   2 years ago   141MB

# 可以指定具体tag


# 值列出就像的id
[node2@Serverb ~]$ docker images -q
4a19aeaf68e5
605c77e624dd
5d0da3dc9764
e69d4e2b6757

# 格式化输出显示
# 这是docker的模版语言 --format
[node2@Serverb ~]$ docker images --format "{{.ID}}--{{.Repository}}"
4a19aeaf68e5--dockurr/windows
605c77e624dd--nginx
5d0da3dc9764--centos
e69d4e2b6757--boystar/ubantu


```

## 删除镜像

```perl
# 拉取hello镜像
docker pull chenlicn163/hello-word 
docker images
docker run -d 3ed90589c0b6
docker rmi chenlicn163/hello-word
docker run -d chenlicn163/hello-word

[node2@Serverb ~]$ docker pull chenlicn163/hello-word 
Using default tag: latest
latest: Pulling from chenlicn163/hello-word
19223ab0feef: Pull complete 
Digest: sha256:2b7b800ab2ef8f0c2c3331ee170af82c3613b167d20e56d1884dca4772fee6c3
Status: Downloaded newer image for chenlicn163/hello-word:latest
docker.io/chenlicn163/hello-word:latest
[node2@Serverb ~]$ docker images
REPOSITORY               TAG       IMAGE ID       CREATED       SIZE
chenlicn163/hello-word   latest    3ed90589c0b6   5 years ago   844kB
# 运行hello镜像
[node2@Serverb ~]$ docker run -d 3ed90589c0b6
370822c24b48d2a5181a03207860530be662efc76de14867e5eca13120c69bea
[node2@Serverb ~]$ docker ps -a
CONTAINER ID   IMAGE          COMMAND                   CREATED         STATUS                      PORTS                                   NAMES
370822c24b48   3ed90589c0b6   "/hello"                  3 seconds ago   Exited (13) 2 seconds ago                                           lucid_cerf
e6582a1b4e32   centos         "/bin/bash"               2 hours ago     Exited (0) 2 hours ago                                              sleepy_tharp
7feff9e22b49   centos         "bash"                    2 hours ago     Up 2 hours                                                          friendly_liskov
d84f1adc3a64   nginx          "/docker-entrypoint.…"   3 hours ago     Up 3 hours                  0.0.0.0:8080->80/tcp, :::8080->80/tcp   strange_snyder

# 删除镜像
[node2@Serverb ~]$ docker rmi chenlicn163/hello-word
Error response from daemon: conflict: unable to remove repository reference "chenlicn163/hello-word" (must force) - container 370822c24b48 is using its referenced image 3ed90589c0b6

# 当该镜像有被容器使用时（只要docker ps -a能够查看到使用该镜像的容器），不得删除该镜像
[node2@Serverb ~]$ docker run -d chenlicn163/hello-word
4c1cbc46c59067b0a4bb3e96bdb50c77f602e0fb5cb326fc3d8ee5ccfa0b5518
[node2@Serverb ~]$ docker ps -a
CONTAINER ID   IMAGE                    COMMAND    CREATED         STATUS                     PORTS     NAMES
4c1cbc46c590   chenlicn163/hello-word   "/hello"   2 seconds ago   Exited (13) 1 second ago             interesting_mirzakhani
[node2@Serverb ~]$ docker rmi 3ed90589c0b6
Error response from daemon: conflict: unable to delete 3ed90589c0b6 (must be forced) - image is being used by stopped container 4c1cbc46c590
[node2@Serverb ~]$ docker rm 4c1cbc46c590
4c1cbc46c590
[node2@Serverb ~]$ docker rmi 3ed90589c0b6
Untagged: chenlicn163/hello-word:latest
Untagged: chenlicn163/hello-word@sha256:2b7b800ab2ef8f0c2c3331ee170af82c3613b167d20e56d1884dca4772fee6c3
Deleted: sha256:3ed90589c0b616588075b9b95a5e3dc65af7b05bd660d35f54a37f2473facea9
Deleted: sha256:6b73d082fc935f44cdd92c23bcabfd9ceee6dd4430ef4449d07d1e792059f84c
```

## 镜像管理
```perl
# `` 表示只输出命令执行的结果
# 批量删除容器
docker rm `docker ps -aq`
# 批量删除镜像
docker rmi `docker images -q`

docker image save centos:7.8.2003 > /data/centos7.8.2003.tgz
docker image load -i /data/centos7.8.2003.tgz

# 导出镜像
docker commit

# 导出镜像的命令
[node2@Serverb ~]$ docker image save centos:7.8.2003 > /data/centos7.8.2003.tgz
[node2@Serverb ~]$ ll /data/
总用量 206148
-rw-rw-r-- 1 node2 node2 211077120 5月  18 16:49 centos7.8.2003.tgz

# 导入镜像的命令
# 
[node2@Serverb ~]$ docker images
REPOSITORY   TAG       IMAGE ID   CREATED   SIZE
[node2@Serverb ~]$ docker image load -i /data/centos7.8.2003.tgz 
fb82b029bea0: Loading layer [==================================================>]  211.1MB/211.1MB
Loaded image: centos:7.8.2003
[node2@Serverb ~]$ 


# 查看镜像详细信息
# 查看docker服务的信息
docker info
# 

docker image inspect 镜像id
docker image inspect 镜像id前三位
```
