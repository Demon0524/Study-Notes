#ComputerNetwork
[TOC]

# 内网部署类

## 1、VLAN及命名

> 定义：

- VLAN（Virtual Local Area Network）--虚拟局域网；是将一个物理LAN在螺髻山划分成多个广播域对的通信技术
- 每一个VLAN是一个广播域。同一个VLAN内的主机能够直接通信；不同VLAN之间怎能直接互通

> **作用的网络层次：**

- 简单划分VLAN时：数据链路层
- 使用VLANIF进行通信时：传输层



> 优点：

- **限制广播域：** 广播域被限制在一个VLAN中，节省了带宽、太高了网络处理能力
- **增强局域网的安全性：** 不同VLAN内的报文在传输时相互隔离；不同VLAN之间用户不能直接通信
- **提高了网络的健壮性：** 故障被限制在一个VLAN中，本VLAN内的故障不会影响其它VLAN的正常工作
- **灵活构建虚拟工作组：** 用VLAN可以划分不同的用户到不同的工作组，同一工作组的用户也不必局限于某一个固定的物理范围



### 1.1、VLAN vs 子网

|      | VLAN                                                         | 子网                                                         |
| :--: | :----------------------------------------------------------- | :----------------------------------------------------------- |
| 区别 | 用于划分二层网络                                             | 用于划分三层网络                                             |
|      | 在配置==**VLANIF**==接口的基础上实现路由互通后，属于不同VLAN的用户才能互访 | 只要通过==**路由**==实现网络互通，属于不同子网的用户就能互访 |
|      | 可划分4094个VLAN，VLAN内的设备数量不受限制                   | 划分内的网段数量会影响各个子网内的设备最大数量               |
| 联系 | 同一VLAN内，可以划分一个或多个网段                           | 同一子网内，可以划分一个或多个VLAn                           |



### 1.2、VLAN Tag和VLAN ID
> [[../../报文格式地址地图/数据链路层/VLAN帧格式]]

- 要使交换机能够分辨不同VLAN的报文，需要在报文中添加识别VLAN信息的字段。==IEEE802.1Q==协议规定，在以太网数据帧中加入==**4个字节**==的VLAN标签（VLAN Tag）用以表示VLAN信息

![image-IEEE 802.1Q封装的VLAN数据帧格式](https://download.huawei.com/mdl/image/download?uuid=6b7f04dbe20643d3a42fe55ad4eb6cef)

> VLAN ID

- 数据帧中的VID（VLAN ID）字段标识了该数据帧的所属VLAN，数据帧只能在其所属VLAN内进行传输。
- 取值范围：0\~4095；有效取值范围：1~4094

> VLAN Tag

- 交换机内部处理的数据帧都带有VLAN Tag。
- 交换机连接的部分设备（用户主机、服务器）等之后收发不带VLAN Tag的传统以太网数据帧。在与这些设备进行通信时，需要交换机的接口能够识别传统以太网数据帧，并在收发时给帧**添加、剥除**VLAN Tag。

### 1.3、VLAN接口类型和VLAN标签的处理

- 根据接口连接对象及收发数据帧处理的不同，使用不同的接口类型

> ==**Access接口**：==
>
> - 用于不能识别Tag的用户终端；
>
> - 不需要区分不同VLAN成员；

- **无标记帧（Untagged帧）：** 原始的、未加4字节VLAN标签的帧
- **有标签帧（tageed帧）：** 加入了4字节VLAN标签的帧

- **工作状态：**
  - 当Access接口收到带有Tag的帧，并且帧中VID与PVID（接口设置的VLAN ID）相同时，Access接口也能接收并处理该帧。
  - 在发送带有Tag的帧前，Access接口会剥离Tag。

> ==**Trunk接口：**==
>
> - 用于连接交换机、路由器、Ap以及可同时收发Tageed帧的Untagged帧的终端
> - 允许多个VLAN的帧带Tag通过
> - 属于缺省VLAN的帧通过时剥除Tag

- Trunk接口上的缺省VLAN，有的厂商也将它定义为native VLAN。
- 当Trunk接口收到Untagged帧时，会为Untagged帧打上Native VLAN对应的Tag。

> ==**Hybrid接口：**==
>
> - 同时具备Access和Trunk接口的特性

- 比如在灵活**QinQ**中，服务提供商网络的多个VLAN的报文在进入用户网络前，需要剥离外层VLAN Tag，此时Trunk接口不能实现该功能




















